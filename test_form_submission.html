<!DOCTYPE html>
<html>
<head>
    <title>フォーム送信テスト</title>
    <meta name="csrf-token" content="">
</head>
<body>
    <h1>店舗選択フォーム送信テスト</h1>

    <form id="testForm" method="POST" action="https://reservation.meno-training.com/reservation/store-selection">
        <input type="hidden" name="_token" value="">
        <input type="hidden" name="store_id" value="1">
        <button type="submit">銀座本店を選択</button>
    </form>

    <script>
    // CSRFトークンを動的に取得してフォームに設定
    async function prepareForm() {
        try {
            const response = await fetch('https://reservation.meno-training.com/stores');
            const html = await response.text();

            const tokenMatch = html.match(/name="csrf-token" content="([^"]+)"/);
            const csrfToken = tokenMatch ? tokenMatch[1] : null;

            if (csrfToken) {
                document.querySelector('meta[name="csrf-token"]').content = csrfToken;
                document.querySelector('input[name="_token"]').value = csrfToken;
                console.log('CSRFトークンを設定しました:', csrfToken.substring(0, 20) + '...');
            } else {
                console.error('CSRFトークンが取得できませんでした');
            }
        } catch (error) {
            console.error('トークン取得エラー:', error);
        }
    }

    // フォーム送信をインターセプト
    document.getElementById('testForm').addEventListener('submit', function(e) {
        console.log('フォーム送信中...');
        console.log('Token:', document.querySelector('input[name="_token"]').value.substring(0, 20) + '...');
        console.log('Store ID:', document.querySelector('input[name="store_id"]').value);

        // 実際に送信を続行
        return true;
    });

    // ページロード時にトークンを準備
    prepareForm();
    </script>
</body>
</html>