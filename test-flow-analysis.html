<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äºˆç´„ãƒ•ãƒ­ãƒ¼è§£æ</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-bold mb-4">ğŸ” äºˆç´„ãƒ•ãƒ­ãƒ¼å•é¡Œåˆ†æ</h1>
        
        <div class="grid md:grid-cols-2 gap-4 mb-6">
            <div class="bg-white p-4 rounded shadow">
                <h2 class="font-bold mb-2">ç¾åœ¨ã®äºˆç´„ãƒ•ãƒ­ãƒ¼ç¢ºèª</h2>
                <button onclick="testReservationFlow()" class="bg-blue-500 text-white px-4 py-2 rounded">
                    äºˆç´„ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆé–‹å§‹
                </button>
                <div id="flow-results" class="mt-4 text-sm"></div>
            </div>
            
            <div class="bg-white p-4 rounded shadow">
                <h2 class="font-bold mb-2">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å•é¡Œåˆ†æ</h2>
                <button onclick="testDashboard()" class="bg-green-500 text-white px-4 py-2 rounded">
                    ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ
                </button>
                <div id="dashboard-results" class="mt-4 text-sm"></div>
            </div>
        </div>
        
        <div class="bg-white p-4 rounded shadow">
            <h2 class="font-bold mb-2">ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œã¨ä¿®æ­£ç‚¹</h2>
            <div id="issues-list" class="space-y-2"></div>
        </div>
    </div>
    
    <script>
        const issues = [];
        
        async function testReservationFlow() {
            const results = document.getElementById('flow-results');
            results.innerHTML = '<div class="text-blue-600">äºˆç´„ãƒ•ãƒ­ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆä¸­...</div>';
            
            try {
                // 1. åº—èˆ—ä¸€è¦§
                let response = await fetch('/stores');
                logResult('åº—èˆ—ä¸€è¦§ãƒšãƒ¼ã‚¸', response.status === 200, results);
                
                // 2. ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ãªã—ï¼‰
                response = await fetch('/reservation/category');
                const categoryRedirect = response.url.includes('/reservation/store');
                logResult('ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒšãƒ¼ã‚¸', !categoryRedirect, results, categoryRedirect ? 'åº—èˆ—é¸æŠã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹' : '');
                
                if (categoryRedirect) {
                    issues.push('âŒ ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠ: ã‚»ãƒƒã‚·ãƒ§ãƒ³ãªã—ã§ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„');
                }
                
                // 3. æ™‚é–“é¸æŠï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ãªã—ï¼‰
                response = await fetch('/reservation/time');
                const timeRedirect = response.url.includes('/reservation/store');
                logResult('æ™‚é–“é¸æŠãƒšãƒ¼ã‚¸', !timeRedirect, results, timeRedirect ? 'åº—èˆ—é¸æŠã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹' : '');
                
                if (timeRedirect) {
                    issues.push('âŒ æ™‚é–“é¸æŠ: ã‚»ãƒƒã‚·ãƒ§ãƒ³ãªã—ã§ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„');
                }
                
                // 4. ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ãªã—ï¼‰
                response = await fetch('/reservation/calendar');
                const calendarRedirect = response.url.includes('/reservation/store');
                logResult('ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒšãƒ¼ã‚¸', !calendarRedirect, results, calendarRedirect ? 'åº—èˆ—é¸æŠã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹' : '');
                
                if (calendarRedirect) {
                    issues.push('âŒ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼: ã‚»ãƒƒã‚·ãƒ§ãƒ³ãªã—ã§ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„');
                }
                
                updateIssuesList();
                
            } catch (error) {
                results.innerHTML += `<div class="text-red-600">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }
        
        async function testDashboard() {
            const results = document.getElementById('dashboard-results');
            results.innerHTML = '<div class="text-green-600">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ãƒ†ã‚¹ãƒˆä¸­...</div>';
            
            try {
                // 1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸
                let response = await fetch('/customer/dashboard');
                logResult('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸', response.status === 200, results);
                
                // 2. ãƒ¢ãƒ€ãƒ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
                response = await fetch('/customer/dashboard-modern');
                logResult('ãƒ¢ãƒ€ãƒ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', response.status === 200, results);
                
                // 3. è¦–åŠ›æ¨ç§»
                response = await fetch('/customer/vision-progress');
                logResult('è¦–åŠ›æ¨ç§»ãƒšãƒ¼ã‚¸', response.status === 200, results);
                
                // 4. APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆèªè¨¼ãªã—ï¼‰
                response = await fetch('/api/customer/reservations');
                const needsAuth = response.status === 401;
                logResult('äºˆç´„API', needsAuth, results, needsAuth ? 'èªè¨¼ãŒå¿…è¦ï¼ˆæ­£å¸¸ï¼‰' : 'èªè¨¼ãªã—ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼ˆå•é¡Œï¼‰');
                
                if (!needsAuth && response.status === 200) {
                    issues.push('âŒ API: èªè¨¼ãªã—ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œï¼‰');
                }
                
                updateIssuesList();
                
            } catch (error) {
                results.innerHTML += `<div class="text-red-600">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }
        
        function logResult(test, success, container, note = '') {
            const status = success ? 'âœ…' : 'âŒ';
            const color = success ? 'text-green-600' : 'text-red-600';
            const noteText = note ? ` (${note})` : '';
            container.innerHTML += `<div class="${color}">${status} ${test}${noteText}</div>`;
        }
        
        function updateIssuesList() {
            const container = document.getElementById('issues-list');
            
            // æ—¢çŸ¥ã®å•é¡Œã‚’è¿½åŠ 
            const knownIssues = [
                'âŒ ã‚´ãƒ¼ãƒ«ãƒ‰ä¼šå“¡è¡¨ç¤º: å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã‹ãªã„æ¶ç©ºã®ä¼šå“¡åˆ¶åº¦',
                'âŒ ãƒã‚¤ãƒ³ãƒˆè¡¨ç¤º: å®Ÿè£…ã•ã‚Œã¦ã„ãªã„ãƒã‚¤ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ',
                'âŒ ãƒ©ãƒ³ã‚¯ã‚¢ãƒƒãƒ—: æ„å‘³ä¸æ˜ãªæ©Ÿèƒ½è¡¨ç¤º',
                'âš ï¸ è¦–åŠ›æ¨ç§»: ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã€å®Ÿãƒ‡ãƒ¼ã‚¿ãªã—',
                'âš ï¸ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†: é©åˆ‡ã«å‹•ä½œã™ã‚‹ãŒã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¸è¶³'
            ];
            
            const allIssues = [...issues, ...knownIssues];
            
            container.innerHTML = allIssues.map(issue => 
                `<div class="p-2 bg-yellow-50 border-l-4 border-yellow-400 text-sm">${issue}</div>`
            ).join('');
            
            // æ¨å¥¨ä¿®æ­£ç‚¹ã‚’è¿½åŠ 
            container.innerHTML += `
                <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded">
                    <h3 class="font-bold text-blue-800 mb-2">ğŸ”§ æ¨å¥¨ä¿®æ­£ç‚¹</h3>
                    <ol class="text-sm text-blue-700 space-y-1">
                        <li>1. æ¶ç©ºãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤ï¼ˆã‚´ãƒ¼ãƒ«ãƒ‰ä¼šå“¡ã€ãƒã‚¤ãƒ³ãƒˆãªã©ï¼‰</li>
                        <li>2. å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«åŸºã¥ãè¡¨ç¤ºã«ä¿®æ­£</li>
                        <li>3. ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã®é©åˆ‡ãªãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</li>
                        <li>4. ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡ã‚Œæ™‚ã®é©åˆ‡ãªæ¡ˆå†…</li>
                        <li>5. ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã®ä»£æ›¿è¡¨ç¤º</li>
                        <li>6. ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Šï¼ˆåˆ†ã‹ã‚Šã‚„ã™ã„è¡¨ç¤ºï¼‰</li>
                    </ol>
                </div>
            `;
        }
        
        // åˆæœŸè¡¨ç¤º
        updateIssuesList();
    </script>
</body>
</html>