<!DOCTYPE html>
<html>
<head>
    <title>サブスク予約APIテスト</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 5px; }
        .available { color: green; font-weight: bold; }
        .unavailable { color: red; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>サブスク予約API直接テスト</h1>
    
    <div>
        <button onclick="setSession()">1. セッションデータ設定</button>
        <button onclick="checkDates()">2. 日付チェック開始</button>
    </div>
    
    <div id="results"></div>

    <script>
        function setSession() {
            // 顧客データ設定
            const customerData = {
                id: 48,
                last_name: "大山",
                first_name: "花梨",
                phone: "08033372305",
                email: "test@example.com"
            };
            
            localStorage.setItem('customer_data', JSON.stringify(customerData));
            localStorage.setItem('customer_token', 'test-token');
            
            sessionStorage.setItem('existing_customer_id', '48');
            sessionStorage.setItem('subscription_store_id', '1');
            sessionStorage.setItem('subscription_menu_id', '1');
            sessionStorage.setItem('subscription_store_name', '銀座本店');
            sessionStorage.setItem('subscription_menu_name', 'スタンダードコース');
            
            document.getElementById('results').innerHTML = '<div class="result">✅ セッションデータ設定完了</div>';
        }
        
        async function checkDates() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="result">チェック開始...</div>';
            
            // チェックする日付（9/25から10/2）
            const dates = [
                '2025-09-25', '2025-09-26', '2025-09-27', '2025-09-28',
                '2025-09-29', '2025-09-30', '2025-10-01', '2025-10-02'
            ];
            
            const results = [];
            
            for (const date of dates) {
                try {
                    const response = await fetch('/api/check-availability', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            store_id: 1,
                            menu_id: 1,
                            date: date,
                            time: '10:00'
                        })
                    });
                    
                    const data = await response.json();
                    
                    const resultClass = data.available ? 'available' : 'unavailable';
                    const symbol = data.available ? '○' : '×';
                    
                    results.push(`
                        <div class="result">
                            <span class="${resultClass}">${symbol}</span> 
                            ${date}: ${data.available ? '予約可能' : '予約不可'} 
                            ${data.reason ? `(理由: ${data.reason})` : ''}
                        </div>
                    `);
                    
                } catch (error) {
                    results.push(`
                        <div class="result unavailable">
                            × ${date}: エラー (${error.message})
                        </div>
                    `);
                }
            }
            
            resultsDiv.innerHTML = results.join('');
        }
        
        // 自動実行
        window.addEventListener('load', () => {
            setSession();
            setTimeout(checkDates, 500);
        });
    </script>
</body>
</html>
