<!DOCTYPE html>
<html>
<head>
    <title>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ—¥ä»˜ç¯„å›²ãƒ‡ãƒãƒƒã‚°</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; cursor: pointer; }
        .result { margin-top: 10px; padding: 10px; background: #f5f5f5; font-family: monospace; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background: #007bff; color: white; }
    </style>
</head>
<body>
    <h1>ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ—¥ä»˜ç¯„å›²ãƒ‡ãƒãƒƒã‚°</h1>

    <div class="section">
        <h2>ç¾åœ¨ã®çŠ¶æ³</h2>
        <p>ä»Šæ—¥: <span id="today"></span></p>
        <p>å•é¡Œ: 9æœˆ25-26æ—¥ãŒÃ—ã€10æœˆ1æ—¥ã ã‘â—‹</p>
    </div>

    <div class="section">
        <h2>ç•°ãªã‚‹é€±ã‚ªãƒ•ã‚»ãƒƒãƒˆã§ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testWeek(0)">Week 0 (ä»Šé€±)</button>
        <button onclick="testWeek(1)">Week 1 (æ¥é€±)</button>
        <button onclick="testWeek(-1)">Week -1 (å…ˆé€±)</button>
        <div id="week-results" class="result"></div>
    </div>

    <div class="section">
        <h2>URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç¢ºèª</h2>
        <button onclick="checkCurrentURL()">ç¾åœ¨ã®URLç¢ºèª</button>
        <div id="url-results" class="result"></div>
    </div>

    <div class="section">
        <h2>æ—¥ä»˜è¨ˆç®—ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
        <button onclick="simulateDateCalculation()">æ—¥ä»˜è¨ˆç®—ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
        <div id="simulation-results" class="result"></div>
    </div>

    <script>
        document.getElementById('today').textContent = new Date().toLocaleDateString('ja-JP');

        async function testWeek(weekOffset) {
            const resultDiv = document.getElementById('week-results');
            resultDiv.innerHTML += `\n=== Week ${weekOffset} ã®ãƒ†ã‚¹ãƒˆ ===\n`;

            const url = `/reservation/calendar?type=subscription&week=${weekOffset}`;

            try {
                const response = await fetch(url);
                const html = await response.text();

                // HTMLã‹ã‚‰æ—¥ä»˜æƒ…å ±ã‚’æŠ½å‡º
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ—¥ä»˜ã‚’å–å¾—
                const dateHeaders = doc.querySelectorAll('th');
                const dates = [];
                dateHeaders.forEach(header => {
                    const text = header.textContent.trim();
                    if (text.match(/^\d+$/)) {  // æ•°å­—ã®ã¿ï¼ˆæ—¥ä»˜ï¼‰
                        dates.push(text);
                    }
                });

                resultDiv.innerHTML += `URL: ${url}\n`;
                resultDiv.innerHTML += `è¡¨ç¤ºã•ã‚Œã‚‹æ—¥ä»˜: [${dates.join(', ')}]\n`;

                // 9æœˆ25æ—¥ã¨10æœˆ1æ—¥ã®çŠ¶æ…‹ã‚’ç¢ºèª
                const sept25Elements = doc.querySelectorAll('[data-date*="2025-09-25"]');
                const oct1Elements = doc.querySelectorAll('[data-date*="2025-10-01"]');

                resultDiv.innerHTML += `9æœˆ25æ—¥ã®è¦ç´ æ•°: ${sept25Elements.length}\n`;
                resultDiv.innerHTML += `10æœˆ1æ—¥ã®è¦ç´ æ•°: ${oct1Elements.length}\n`;

            } catch (error) {
                resultDiv.innerHTML += `ã‚¨ãƒ©ãƒ¼: ${error.message}\n`;
            }

            resultDiv.innerHTML += '\n';
        }

        function checkCurrentURL() {
            const resultDiv = document.getElementById('url-results');
            const currentURL = window.location.href;
            const urlParams = new URLSearchParams(window.location.search);

            resultDiv.innerHTML = `ç¾åœ¨ã®URL: ${currentURL}\n\n`;
            resultDiv.innerHTML += 'URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:\n';

            if (urlParams.size === 0) {
                resultDiv.innerHTML += '(ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãªã—)\n';
            } else {
                for (const [key, value] of urlParams) {
                    resultDiv.innerHTML += `${key}: ${value}\n`;
                }
            }
        }

        function simulateDateCalculation() {
            const resultDiv = document.getElementById('simulation-results');
            const today = new Date();

            resultDiv.innerHTML = '=== PHPã® Carbon::today()->addWeeks($weekOffset) ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ ===\n\n';

            for (let weekOffset = 0; weekOffset <= 2; weekOffset++) {
                const startDate = new Date(today);
                startDate.setDate(today.getDate() + (weekOffset * 7));

                resultDiv.innerHTML += `Week ${weekOffset}:\n`;
                resultDiv.innerHTML += `  é–‹å§‹æ—¥: ${startDate.toLocaleDateString('ja-JP')}\n`;

                const weekDates = [];
                for (let i = 0; i < 7; i++) {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + i);
                    weekDates.push(date.toLocaleDateString('ja-JP'));
                }

                resultDiv.innerHTML += `  7æ—¥é–“: [${weekDates.join(', ')}]\n\n`;
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
        window.addEventListener('load', () => {
            checkCurrentURL();
            simulateDateCalculation();
        });
    </script>
</body>
</html>