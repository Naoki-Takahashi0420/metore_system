# è¤‡æ•°åº—èˆ—å¯¾å¿œ é¡§å®¢ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  å®Ÿè£…ä»•æ§˜æ›¸

**ä½œæˆæ—¥**: 2025-10-15
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: å®Ÿè£…å¾…ã¡

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ç¾çŠ¶ã®å•é¡Œ](#ç¾çŠ¶ã®å•é¡Œ)
3. [è§£æ±ºç­–](#è§£æ±ºç­–)
4. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¤‰æ›´](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¤‰æ›´)
5. [ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…](#ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…)
6. [ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…](#ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…)
7. [UI/UXä»•æ§˜](#uiuxä»•æ§˜)
8. [ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª](#ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª)
9. [ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †](#ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †)
10. [ãƒªã‚¹ã‚¯ã¨å¯¾ç­–](#ãƒªã‚¹ã‚¯ã¨å¯¾ç­–)

---

## æ¦‚è¦

### ç›®çš„
åŒã˜é¡§å®¢ãŒè¤‡æ•°åº—èˆ—ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã€ãƒã‚¤ãƒšãƒ¼ã‚¸ã§åº—èˆ—ã‚’åˆ‡ã‚Šæ›¿ãˆã¦å„åº—èˆ—ã®ãƒ‡ãƒ¼ã‚¿ã‚’é–²è¦§ã§ãã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã€‚

### èƒŒæ™¯
- **ç¾åœ¨ã®å•é¡Œ**: åŒã˜é›»è©±ç•ªå·ã§è¤‡æ•°åº—èˆ—ã«ç™»éŒ²ã§ããªã„ï¼ˆUNIQUEåˆ¶ç´„é•åï¼‰
- **ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹**: ç”°ä¸­å¤ªéƒã•ã‚“ãŒæ–°å®¿åº—ã¨ç§‹è‘‰åŸåº—ã®ä¸¡æ–¹ã‚’åˆ©ç”¨ã—ãŸã„
- **ãƒ“ã‚¸ãƒã‚¹è¦ä»¶**: åº—èˆ—é–“ã§ã®é¡§å®¢ã®ç§»å‹•ã‚’è¨±å®¹ã™ã‚‹

### ã‚¹ã‚³ãƒ¼ãƒ—
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹UNIQUEåˆ¶ç´„ã®å¤‰æ›´
- âœ… ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®åº—èˆ—é¸æŠæ©Ÿèƒ½
- âœ… ãƒã‚¤ãƒšãƒ¼ã‚¸ã§ã®åº—èˆ—åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
- âœ… é¡§å®¢ã‚¤ãƒ³ãƒãƒ¼ãƒˆå‡¦ç†ã®èª¿æ•´
- âŒ é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã®çµ±åˆï¼ˆåŒä¸€äººç‰©ã‚’1ã¤ã®IDã«ã¾ã¨ã‚ã‚‹æ©Ÿèƒ½ã¯**å®Ÿè£…ã—ãªã„**ï¼‰

### è¨­è¨ˆæ–¹é‡
**ã€Œã‚·ãƒ³ãƒ—ãƒ«é‡è¦–ã€**: è¤‡é›‘ãªä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ä½¿ç”¨ã›ãšã€æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’ç¶­æŒã—ãŸã¾ã¾å®Ÿè£…ã™ã‚‹ã€‚

---

## ç¾çŠ¶ã®å•é¡Œ

### å•é¡Œ1: ç§‹è‘‰åŸåº—ã®é¡§å®¢ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼

**ç¾è±¡**:
```
ç§‹è‘‰åŸåº—ã§180ä»¶ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’å®Ÿæ–½
â†’ 93ä»¶ã®ã¿æˆåŠŸ
â†’ 87ä»¶ãŒã€Œé›»è©±ç•ªå·ãŒæ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€ã‚¨ãƒ©ãƒ¼
```

**åŸå› **:
```sql
-- ç¾åœ¨ã®UNIQUEåˆ¶ç´„
ALTER TABLE customers ADD UNIQUE (phone);
ALTER TABLE customers ADD UNIQUE (email);
```

ã“ã‚Œã«ã‚ˆã‚Šã€**å…¨åº—èˆ—ã§1ã¤ã®é›»è©±ç•ªå·ã—ã‹ç™»éŒ²ã§ããªã„**ã€‚

### å•é¡Œ2: ãƒã‚¤ãƒšãƒ¼ã‚¸ã®èªè¨¼å•é¡Œ

**ç¾åœ¨ã®ä»•çµ„ã¿**:
```php
// CustomerAuthController.php
$customer = Customer::where('phone', $phone)->first();
```

**å•é¡Œç‚¹**:
- åŒã˜é›»è©±ç•ªå·ã§è¤‡æ•°ã®customer_idãŒå­˜åœ¨ã™ã‚‹å ´åˆã€`first()` ã¯æœ€åˆã®1ä»¶ã®ã¿å–å¾—
- ç”°ä¸­å¤ªéƒã•ã‚“ãŒæ–°å®¿åº—ï¼ˆcustomer_id=100ï¼‰ã¨ç§‹è‘‰åŸåº—ï¼ˆcustomer_id=200ï¼‰ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å ´åˆã€å¸¸ã«customer_id=100ã§ãƒ­ã‚°ã‚¤ãƒ³ã•ã‚Œã‚‹
- **ç§‹è‘‰åŸåº—ã®ãƒ‡ãƒ¼ã‚¿ãŒæ°¸é ã«è¦‹ãˆãªã„**

---

## è§£æ±ºç­–

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ: ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ–¹å¼

#### åŸºæœ¬è¨­è¨ˆ
```
ç”°ä¸­å¤ªéƒã•ã‚“ (phone: 09012345678)
â”œâ”€ æ–°å®¿åº—: customer_id = 100, store_id = 1
â””â”€ ç§‹è‘‰åŸåº—: customer_id = 200, store_id = 4

ãƒã‚¤ãƒšãƒ¼ã‚¸:
1. ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«ä¸¡æ–¹ã® customer_id ã‚’æ¤œå‡º
2. åº—èˆ—é¸æŠç”»é¢ã‚’è¡¨ç¤º
3. é¸æŠã—ãŸ customer_id ã§ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œ
4. ãƒã‚¤ãƒšãƒ¼ã‚¸ã§åº—èˆ—åˆ‡ã‚Šæ›¿ãˆå¯èƒ½
```

#### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
```
é›»è©±ç•ªå·å…¥åŠ› (09012345678)
  â†“
OTPèªè¨¼
  â†“
Customer::where('phone', '09012345678')->get()
  â†’ 2ä»¶è¦‹ã¤ã‹ã‚‹
  â†“
åº—èˆ—é¸æŠç”»é¢è¡¨ç¤º
  [ ] æ–°å®¿åº— (æœ€çµ‚æ¥åº—: 2025-01-15)
  [ ] ç§‹è‘‰åŸåº— (æœ€çµ‚æ¥åº—: 2025-02-10)
  â†“
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç§‹è‘‰åŸåº—ã‚’é¸æŠ
  â†“
customer_id=200 ã§ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œ
  â†“
ãƒã‚¤ãƒšãƒ¼ã‚¸è¡¨ç¤ºï¼ˆç§‹è‘‰åŸåº—ã®ãƒ‡ãƒ¼ã‚¿ï¼‰
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¤‰æ›´

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: UNIQUEåˆ¶ç´„ã®å¤‰æ›´

**ãƒ•ã‚¡ã‚¤ãƒ«**: `database/migrations/YYYY_MM_DD_HHMMSS_change_customer_unique_constraints.php`

```php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
use Illuminate\Support\Facades\DB;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        // SQLiteã®å ´åˆã¯ç‰¹åˆ¥ãªå‡¦ç†ãŒå¿…è¦
        if (DB::getDriverName() === 'sqlite') {
            // SQLiteã§ã¯ALTER TABLEã§UNIQUEåˆ¶ç´„ã‚’å¤‰æ›´ã§ããªã„ãŸã‚ã€
            // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å†ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹
            $this->recreateTableForSqlite();
        } else {
            // MySQL/PostgreSQLã®å ´åˆ
            Schema::table('customers', function (Blueprint $table) {
                // æ—¢å­˜ã®UNIQUEåˆ¶ç´„ã‚’å‰Šé™¤
                $table->dropUnique('customers_phone_unique');
                $table->dropUnique('customers_email_unique');

                // åº—èˆ—ã”ã¨ã®UNIQUEåˆ¶ç´„ã‚’è¿½åŠ 
                $table->unique(['store_id', 'phone'], 'customers_store_phone_unique');
                $table->unique(['store_id', 'email'], 'customers_store_email_unique');
            });
        }
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        if (DB::getDriverName() === 'sqlite') {
            // ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ã®å‡¦ç†
            $this->recreateTableForSqliteRollback();
        } else {
            Schema::table('customers', function (Blueprint $table) {
                // è¤‡åˆUNIQUEåˆ¶ç´„ã‚’å‰Šé™¤
                $table->dropUnique('customers_store_phone_unique');
                $table->dropUnique('customers_store_email_unique');

                // å…ƒã®UNIQUEåˆ¶ç´„ã‚’å¾©å…ƒ
                $table->unique('phone', 'customers_phone_unique');
                $table->unique('email', 'customers_email_unique');
            });
        }
    }

    /**
     * SQLiteç”¨ã®ãƒ†ãƒ¼ãƒ–ãƒ«å†ä½œæˆå‡¦ç†
     */
    private function recreateTableForSqlite(): void
    {
        // 1. ä¸€æ™‚ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
        DB::statement('CREATE TABLE customers_temp AS SELECT * FROM customers');

        // 2. å…ƒã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‰Šé™¤
        Schema::dropIfExists('customers');

        // 3. æ–°ã—ã„ã‚¹ã‚­ãƒ¼ãƒã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å†ä½œæˆ
        Schema::create('customers', function (Blueprint $table) {
            $table->id();
            $table->foreignId('store_id')->nullable()->constrained('stores')->onDelete('cascade');
            $table->string('last_name', 100)->comment('å§“');
            $table->string('first_name', 100)->comment('å');
            $table->string('last_name_kana', 100)->nullable()->comment('å§“ã‚«ãƒŠ');
            $table->string('first_name_kana', 100)->nullable()->comment('åã‚«ãƒŠ');
            $table->string('phone', 20)->comment('é›»è©±ç•ªå·');
            $table->string('email')->nullable()->comment('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹');
            $table->date('birth_date')->nullable()->comment('ç”Ÿå¹´æœˆæ—¥');
            $table->enum('gender', ['male', 'female', 'other'])->nullable()->comment('æ€§åˆ¥');
            $table->string('postal_code', 8)->nullable()->comment('éƒµä¾¿ç•ªå·');
            $table->string('prefecture')->nullable();
            $table->string('city')->nullable();
            $table->text('address')->nullable()->comment('ä½æ‰€');
            $table->string('building')->nullable();
            $table->json('preferences')->nullable()->comment('è¨­å®šãƒ»å—œå¥½');
            $table->json('medical_notes')->nullable()->comment('åŒ»ç™‚ãƒ¡ãƒ¢');
            $table->text('notes')->nullable();
            $table->text('characteristics')->nullable();
            $table->boolean('is_blocked')->default(false)->comment('ãƒ–ãƒ­ãƒƒã‚¯çŠ¶æ…‹');
            $table->integer('cancellation_count')->default(0);
            $table->integer('no_show_count')->default(0);
            $table->integer('change_count')->default(0);
            $table->timestamp('last_cancelled_at')->nullable();
            $table->timestamp('last_visit_at')->nullable()->comment('æœ€çµ‚æ¥åº—æ—¥');
            $table->timestamp('phone_verified_at')->nullable()->comment('é›»è©±ç•ªå·èªè¨¼æ—¥æ™‚');
            $table->boolean('sms_notifications_enabled')->default(true);
            $table->json('notification_preferences')->nullable();
            $table->string('customer_number')->nullable();
            $table->string('line_registration_source')->nullable();
            $table->foreignId('line_registration_store_id')->nullable();
            $table->foreignId('line_registration_reservation_id')->nullable();
            $table->timestamp('line_registered_at')->nullable();
            $table->timestamp('last_campaign_sent_at')->nullable();
            $table->integer('campaign_send_count')->default(0);
            $table->timestamp('line_followup_30d_sent_at')->nullable();
            $table->timestamp('line_followup_60d_sent_at')->nullable();
            $table->timestamp('line_followup_7d_sent_at')->nullable();
            $table->timestamp('line_followup_15d_sent_at')->nullable();
            $table->string('line_user_id')->nullable();
            $table->boolean('line_notifications_enabled')->default(false);
            $table->timestamp('line_linked_at')->nullable();
            $table->json('line_profile')->nullable();
            $table->timestamps();

            // ğŸ†• åº—èˆ—ã”ã¨ã®UNIQUEåˆ¶ç´„
            $table->unique(['store_id', 'phone'], 'customers_store_phone_unique');
            $table->unique(['store_id', 'email'], 'customers_store_email_unique');
            $table->unique(['store_id', 'customer_number'], 'customers_store_customer_number_unique');

            // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
            $table->index('store_id');
            $table->index('phone_verified_at');
            $table->index('last_visit_at');
            $table->index('is_blocked');
            $table->index(['last_name', 'first_name']);
            $table->index('line_user_id');
            $table->index('cancellation_count');
            $table->index('no_show_count');
        });

        // 4. ãƒ‡ãƒ¼ã‚¿ã‚’æˆ»ã™
        DB::statement('INSERT INTO customers SELECT * FROM customers_temp');

        // 5. ä¸€æ™‚ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‰Šé™¤
        DB::statement('DROP TABLE customers_temp');
    }

    /**
     * SQLiteç”¨ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
     */
    private function recreateTableForSqliteRollback(): void
    {
        // åŒæ§˜ã®å‡¦ç†ã§å…ƒã®ã‚¹ã‚­ãƒ¼ãƒã«æˆ»ã™
        DB::statement('CREATE TABLE customers_temp AS SELECT * FROM customers');
        Schema::dropIfExists('customers');

        // å…ƒã®ã‚¹ã‚­ãƒ¼ãƒã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å†ä½œæˆï¼ˆphone, email ã« UNIQUE åˆ¶ç´„ï¼‰
        Schema::create('customers', function (Blueprint $table) {
            // ... (å…ƒã®ã‚¹ã‚­ãƒ¼ãƒ)
            $table->string('phone', 20)->unique()->comment('é›»è©±ç•ªå·');
            $table->string('email')->unique()->nullable()->comment('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹');
            // ...
        });

        DB::statement('INSERT INTO customers SELECT * FROM customers_temp');
        DB::statement('DROP TABLE customers_temp');
    }
};
```

### å¤‰æ›´å†…å®¹

#### Beforeï¼ˆç¾åœ¨ï¼‰
```sql
UNIQUE (phone)           -- å…¨åº—èˆ—ã§1ã¤ã®ã¿
UNIQUE (email)           -- å…¨åº—èˆ—ã§1ã¤ã®ã¿
UNIQUE (store_id, customer_number)  -- åº—èˆ—ã”ã¨ï¼ˆæ—¢å­˜ï¼‰
```

#### Afterï¼ˆå¤‰æ›´å¾Œï¼‰
```sql
UNIQUE (store_id, phone)          -- ğŸ†• åº—èˆ—ã”ã¨ã«1ã¤
UNIQUE (store_id, email)          -- ğŸ†• åº—èˆ—ã”ã¨ã«1ã¤
UNIQUE (store_id, customer_number) -- æ—¢å­˜ï¼ˆå¤‰æ›´ãªã—ï¼‰
```

### å½±éŸ¿ç¯„å›²

âœ… **å½±éŸ¿ãªã—ï¼ˆãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¯å¤‰æ›´ãªã—ï¼‰**:
- `customers` ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ãƒ©ãƒ æ§‹æˆã¯å¤‰æ›´ãªã—
- `medical_records`, `reservations`, `customer_subscriptions` ãªã©ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯å¤‰æ›´ãªã—

âš ï¸ **å½±éŸ¿ã‚ã‚Šï¼ˆåˆ¶ç´„å¤‰æ›´ï¼‰**:
- åŒã˜é›»è©±ç•ªå·ã§è¤‡æ•°åº—èˆ—ã«ç™»éŒ²å¯èƒ½ã«ãªã‚‹
- åŒã˜ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§è¤‡æ•°åº—èˆ—ã«ç™»éŒ²å¯èƒ½ã«ãªã‚‹

---

## ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…

### 1. ãƒ«ãƒ¼ãƒˆè¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `routes/api.php`

```php
// é¡§å®¢èªè¨¼é–¢é€£
Route::prefix('auth/customer')->group(function () {
    Route::post('send-otp', [CustomerAuthController::class, 'sendOtp']);
    Route::post('verify-otp', [CustomerAuthController::class, 'verifyOtp']);
    Route::post('select-store', [CustomerAuthController::class, 'selectStore']); // ğŸ†•

    Route::middleware('auth:sanctum')->group(function () {
        Route::post('switch-store', [CustomerAuthController::class, 'switchStore']); // ğŸ†•
        Route::post('logout', [CustomerAuthController::class, 'logout']);
    });
});

// é¡§å®¢æƒ…å ±
Route::middleware('auth:sanctum')->group(function () {
    Route::get('customer/stores', [CustomerController::class, 'getStores']); // ğŸ†•
    Route::get('customer/reservations', [CustomerController::class, 'getReservations']);
    Route::get('customer/medical-records', [CustomerController::class, 'getMedicalRecords']);
    // ...
});
```

---

### 2. CustomerAuthController ã®ä¿®æ­£

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/Http/Controllers/Api/Auth/CustomerAuthController.php`

#### 2-1. verifyOtp() ã®ä¿®æ­£

```php
/**
 * OTPæ¤œè¨¼ã¨ãƒ­ã‚°ã‚¤ãƒ³/åº—èˆ—é¸æŠ
 */
public function verifyOtp(Request $request)
{
    $validator = Validator::make($request->all(), [
        'phone' => ['required', 'string', 'regex:/^[0-9\-]+$/'],
        'otp_code' => ['required', 'string', 'size:6'],
        'remember_me' => ['boolean'],
    ]);

    if ($validator->fails()) {
        return response()->json([
            'success' => false,
            'error' => [
                'code' => 'VALIDATION_ERROR',
                'message' => 'å…¥åŠ›å†…å®¹ã«èª¤ã‚ŠãŒã‚ã‚Šã¾ã™',
                'details' => $validator->errors(),
            ],
        ], 422);
    }

    // OTPæ¤œè¨¼
    if (!$this->otpService->verifyOtp($request->phone, $request->otp_code)) {
        return response()->json([
            'success' => false,
            'error' => [
                'code' => 'INVALID_OTP',
                'message' => 'èªè¨¼ã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ããªã„ã‹ã€æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™',
            ],
        ], 401);
    }

    // é›»è©±ç•ªå·ã‚’æ­£è¦åŒ–ã—ã¦é¡§å®¢ã‚’æ¤œç´¢
    $normalizedPhone = PhoneHelper::normalize($request->phone);
    $customers = Customer::where('phone', $normalizedPhone)
        ->with('store')
        ->get();

    // æ­£è¦åŒ–ã—ãŸé›»è©±ç•ªå·ã§è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã€å…ƒã®é›»è©±ç•ªå·ã§ã‚‚æ¤œç´¢
    if ($customers->isEmpty()) {
        $customers = Customer::where('phone', $request->phone)
            ->with('store')
            ->get();
    }

    if ($customers->isEmpty()) {
        return response()->json([
            'success' => false,
            'error' => [
                'code' => 'NO_RESERVATION_HISTORY',
                'message' => 'äºˆç´„å±¥æ­´ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚åˆå›ã®ãŠå®¢æ§˜ã¯æ–°è¦äºˆç´„ã‹ã‚‰ãŠç”³ã—è¾¼ã¿ãã ã•ã„ã€‚',
                'redirect_to_booking' => true,
            ],
        ], 404);
    }

    // ğŸ†• è¤‡æ•°åº—èˆ—ã«ç™»éŒ²ãŒã‚ã‚‹å ´åˆ
    if ($customers->count() > 1) {
        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¸€æ™‚ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
        $tempToken = Str::random(32);
        session([
            'store_selection_' . $tempToken => [
                'phone' => $normalizedPhone,
                'expires_at' => now()->addMinutes(10),
            ]
        ]);

        return response()->json([
            'success' => true,
            'data' => [
                'multiple_accounts' => true,
                'phone' => $normalizedPhone,
                'temp_token' => $tempToken,
                'stores' => $customers->map(function($customer) {
                    return [
                        'customer_id' => $customer->id,
                        'store_id' => $customer->store_id,
                        'store_name' => $customer->store->name,
                        'last_visit_at' => $customer->last_visit_at,
                    ];
                }),
            ],
        ]);
    }

    // 1åº—èˆ—ã®ã¿ã®å ´åˆã¯é€šå¸¸é€šã‚Šãƒ­ã‚°ã‚¤ãƒ³
    $customer = $customers->first();

    // äºˆç´„å±¥æ­´ãƒã‚§ãƒƒã‚¯
    $hasReservations = $customer->reservations()
        ->whereIn('status', ['confirmed', 'completed', 'booked'])
        ->exists();

    if (!$hasReservations) {
        return response()->json([
            'success' => false,
            'error' => [
                'code' => 'NO_RESERVATION_HISTORY',
                'message' => 'äºˆç´„å±¥æ­´ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚',
            ],
        ], 403);
    }

    // ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
    $rememberMe = $request->boolean('remember_me', false);
    $tokenName = $rememberMe ? 'customer-auth-remember' : 'customer-auth';
    $expiresAt = $rememberMe ? now()->addDays(30) : now()->addHours(2);
    $token = $customer->createToken($tokenName, ['*'], $expiresAt)->plainTextToken;

    return response()->json([
        'success' => true,
        'data' => [
            'is_new_customer' => false,
            'token' => $token,
            'customer' => [
                'id' => $customer->id,
                'name' => $customer->full_name,
                'last_name' => $customer->last_name,
                'first_name' => $customer->first_name,
                'phone' => $customer->phone,
                'email' => $customer->email,
                'store_id' => $customer->store_id,
                'store_name' => $customer->store->name,
            ],
        ],
    ]);
}
```

#### 2-2. selectStore() ã®è¿½åŠ 

```php
/**
 * åº—èˆ—é¸æŠå¾Œã®ãƒ­ã‚°ã‚¤ãƒ³
 */
public function selectStore(Request $request)
{
    $validator = Validator::make($request->all(), [
        'temp_token' => ['required', 'string'],
        'customer_id' => ['required', 'integer', 'exists:customers,id'],
        'remember_me' => ['boolean'],
    ]);

    if ($validator->fails()) {
        return response()->json([
            'success' => false,
            'error' => [
                'code' => 'VALIDATION_ERROR',
                'message' => 'å…¥åŠ›å†…å®¹ã«èª¤ã‚ŠãŒã‚ã‚Šã¾ã™',
            ],
        ], 422);
    }

    // ä¸€æ™‚ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
    $tempData = session('store_selection_' . $request->temp_token);

    if (!$tempData || now()->isAfter($tempData['expires_at'])) {
        return response()->json([
            'success' => false,
            'error' => [
                'code' => 'INVALID_TOKEN',
                'message' => 'ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒç„¡åŠ¹ã§ã™ã€‚å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚',
            ],
        ], 401);
    }

    // é¡§å®¢å–å¾—
    $customer = Customer::with('store')->find($request->customer_id);

    // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯: é›»è©±ç•ªå·ãŒä¸€è‡´ã™ã‚‹ã‹
    if ($customer->phone !== $tempData['phone']) {
        return response()->json([
            'success' => false,
            'error' => [
                'code' => 'UNAUTHORIZED',
                'message' => 'ä¸æ­£ãªã‚¢ã‚¯ã‚»ã‚¹ã§ã™',
            ],
        ], 403);
    }

    // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¯ãƒªã‚¢
    session()->forget('store_selection_' . $request->temp_token);

    // ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
    $rememberMe = $request->boolean('remember_me', false);
    $tokenName = $rememberMe ? 'customer-auth-remember' : 'customer-auth';
    $expiresAt = $rememberMe ? now()->addDays(30) : now()->addHours(2);
    $token = $customer->createToken($tokenName, ['*'], $expiresAt)->plainTextToken;

    return response()->json([
        'success' => true,
        'data' => [
            'token' => $token,
            'customer' => [
                'id' => $customer->id,
                'name' => $customer->full_name,
                'last_name' => $customer->last_name,
                'first_name' => $customer->first_name,
                'phone' => $customer->phone,
                'email' => $customer->email,
                'store_id' => $customer->store_id,
                'store_name' => $customer->store->name,
            ],
        ],
    ]);
}
```

#### 2-3. switchStore() ã®è¿½åŠ 

```php
/**
 * åº—èˆ—åˆ‡ã‚Šæ›¿ãˆï¼ˆãƒã‚¤ãƒšãƒ¼ã‚¸ã‹ã‚‰ï¼‰
 */
public function switchStore(Request $request)
{
    $currentCustomer = $request->user();

    $validator = Validator::make($request->all(), [
        'target_customer_id' => ['required', 'integer', 'exists:customers,id'],
    ]);

    if ($validator->fails()) {
        return response()->json([
            'success' => false,
            'error' => [
                'code' => 'VALIDATION_ERROR',
                'message' => 'å…¥åŠ›å†…å®¹ã«èª¤ã‚ŠãŒã‚ã‚Šã¾ã™',
            ],
        ], 422);
    }

    // åˆ‡ã‚Šæ›¿ãˆå…ˆã®é¡§å®¢ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
    $targetCustomer = Customer::with('store')->find($request->target_customer_id);

    // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯: é›»è©±ç•ªå·ãŒä¸€è‡´ã™ã‚‹ã‹
    if ($targetCustomer->phone !== $currentCustomer->phone) {
        return response()->json([
            'success' => false,
            'error' => [
                'code' => 'UNAUTHORIZED',
                'message' => 'ä¸æ­£ãªã‚¢ã‚¯ã‚»ã‚¹ã§ã™',
            ],
        ], 403);
    }

    // ç¾åœ¨ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‰Šé™¤
    $request->user()->currentAccessToken()->delete();

    // æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆ
    $token = $targetCustomer->createToken('customer-auth', ['*'], now()->addHours(2))->plainTextToken;

    return response()->json([
        'success' => true,
        'data' => [
            'token' => $token,
            'customer' => [
                'id' => $targetCustomer->id,
                'name' => $targetCustomer->full_name,
                'last_name' => $targetCustomer->last_name,
                'first_name' => $targetCustomer->first_name,
                'phone' => $targetCustomer->phone,
                'email' => $targetCustomer->email,
                'store_id' => $targetCustomer->store_id,
                'store_name' => $targetCustomer->store->name,
            ],
        ],
    ]);
}
```

---

### 3. CustomerController ã®è¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/Http/Controllers/Api/CustomerController.php`

```php
/**
 * åŒã˜é›»è©±ç•ªå·ã§ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å…¨åº—èˆ—ã‚’å–å¾—
 */
public function getStores(Request $request)
{
    $currentCustomer = $request->user();

    $stores = Customer::where('phone', $currentCustomer->phone)
        ->with('store')
        ->get()
        ->map(function($customer) {
            return [
                'customer_id' => $customer->id,
                'store_id' => $customer->store_id,
                'store_name' => $customer->store->name,
                'last_visit_at' => $customer->last_visit_at,
            ];
        });

    return response()->json([
        'success' => true,
        'data' => $stores
    ]);
}
```

---

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

### 1. ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã®ä¿®æ­£

**ãƒ•ã‚¡ã‚¤ãƒ«**: `resources/views/customer/login.blade.php`

#### JavaScriptéƒ¨åˆ†ã«è¿½åŠ 

```javascript
// æ—¢å­˜ã® verifyOtp é–¢æ•°ã‚’ä¿®æ­£
async function verifyOtp() {
    // ... æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ ...

    const response = await fetch('/api/auth/customer/verify-otp', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            phone: phone,
            otp_code: otpCode,
            remember_me: rememberMe
        })
    });

    const data = await response.json();

    if (!response.ok) {
        // ã‚¨ãƒ©ãƒ¼å‡¦ç†...
        return;
    }

    // ğŸ†• è¤‡æ•°åº—èˆ—ã®å ´åˆ
    if (data.data.multiple_accounts) {
        showStoreSelection(data.data);
        return;
    }

    // 1åº—èˆ—ã®å ´åˆï¼ˆæ—¢å­˜ã®å‡¦ç†ï¼‰
    localStorage.setItem('customer_token', data.data.token);
    localStorage.setItem('customer_data', JSON.stringify(data.data.customer));
    window.location.href = '/customer/dashboard';
}

// ğŸ†• åº—èˆ—é¸æŠç”»é¢ã‚’è¡¨ç¤º
function showStoreSelection(data) {
    const loginForm = document.getElementById('login-form');
    loginForm.innerHTML = `
        <div class="text-center mb-6">
            <h2 class="text-2xl font-bold text-gray-900 mb-2">
                åˆ©ç”¨åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„
            </h2>
            <p class="text-gray-600 text-sm">
                è¤‡æ•°ã®åº—èˆ—ã§ã”ç™»éŒ²ãŒã‚ã‚Šã¾ã™
            </p>
        </div>

        <div class="space-y-3">
            ${data.stores.map(store => `
                <div class="border border-gray-200 rounded-lg p-4 cursor-pointer hover:border-blue-300 hover:bg-blue-50 transition-colors"
                     onclick="selectStore('${data.temp_token}', ${store.customer_id})">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <h3 class="font-semibold text-gray-900">
                                ğŸ“ ${store.store_name}
                            </h3>
                            <p class="text-sm text-gray-600 mt-1">
                                æœ€çµ‚æ¥åº—: ${store.last_visit_at ? new Date(store.last_visit_at).toLocaleDateString('ja-JP') : 'æœªæ¥åº—'}
                            </p>
                        </div>
                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                </div>
            `).join('')}
        </div>
    `;
}

// ğŸ†• åº—èˆ—ã‚’é¸æŠ
async function selectStore(tempToken, customerId) {
    try {
        const response = await fetch('/api/auth/customer/select-store', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                temp_token: tempToken,
                customer_id: customerId,
                remember_me: true
            })
        });

        if (!response.ok) {
            throw new Error('åº—èˆ—é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ');
        }

        const data = await response.json();

        // ãƒˆãƒ¼ã‚¯ãƒ³ã¨é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
        localStorage.setItem('customer_token', data.data.token);
        localStorage.setItem('customer_data', JSON.stringify(data.data.customer));

        // ãƒã‚¤ãƒšãƒ¼ã‚¸ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
        window.location.href = '/customer/dashboard';

    } catch (error) {
        console.error('Store selection error:', error);
        alert('åº—èˆ—é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚');
        window.location.reload();
    }
}
```

---

### 2. ãƒã‚¤ãƒšãƒ¼ã‚¸ã®ä¿®æ­£

**ãƒ•ã‚¡ã‚¤ãƒ«**: `resources/views/customer/dashboard.blade.php`

#### HTMLéƒ¨åˆ†ã®ä¿®æ­£ï¼ˆ14-25è¡Œç›®ï¼‰

```html
<!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
<div class="bg-white rounded-lg shadow-md p-4 md:p-6 mb-6">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div class="flex-1">
            <h1 class="text-xl md:text-2xl font-bold text-gray-900 mb-2">ãƒã‚¤ãƒšãƒ¼ã‚¸</h1>
            <p class="text-sm md:text-base text-gray-600" id="customer-info">
                èª­ã¿è¾¼ã¿ä¸­...
            </p>

            <!-- ğŸ†• åº—èˆ—åˆ‡ã‚Šæ›¿ãˆUIï¼ˆè¤‡æ•°åº—èˆ—ã®å ´åˆã®ã¿è¡¨ç¤ºï¼‰ -->
            <div id="store-switcher" class="hidden mt-2 flex items-center gap-2 flex-wrap">
                <span class="text-sm text-gray-500">ğŸ“</span>
                <span id="current-store-name" class="text-sm font-medium text-blue-600"></span>
                <button id="switch-store-btn"
                        class="text-sm text-blue-600 hover:text-blue-700 font-medium underline decoration-dotted">
                    åº—èˆ—ã‚’åˆ‡ã‚Šæ›¿ãˆ
                </button>
            </div>
        </div>
        <button id="logout-btn" class="bg-gray-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-600 transition-colors">
            ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        </button>
    </div>
</div>
```

#### ãƒ¢ãƒ¼ãƒ€ãƒ«ã®è¿½åŠ ï¼ˆ191è¡Œç›®ã®å¾Œã«è¿½åŠ ï¼‰

```html
<!-- ğŸ†• åº—èˆ—åˆ‡ã‚Šæ›¿ãˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="storeSwitcherModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50">
    <div class="relative mx-auto border w-full max-w-md bg-white rounded-lg shadow-xl">
        <div class="p-6">
            <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium text-gray-900">
                    åˆ©ç”¨åº—èˆ—ã‚’é¸æŠ
                </h3>
                <button onclick="closeStoreSwitcherModal()"
                        class="text-gray-400 hover:text-gray-500">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- åº—èˆ—ãƒªã‚¹ãƒˆ -->
            <div id="store-list" class="space-y-3">
                <!-- å‹•çš„ã«æŒ¿å…¥ -->
            </div>
        </div>
    </div>
</div>
```

#### JavaScriptéƒ¨åˆ†ã®è¿½åŠ ï¼ˆ325è¡Œç›®ã®å¾Œã«è¿½åŠ ï¼‰

```javascript
// ğŸ†• ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«è¤‡æ•°åº—èˆ—ãƒã‚§ãƒƒã‚¯
document.addEventListener('DOMContentLoaded', async function() {
    // ... æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ ...

    // è¤‡æ•°åº—èˆ—ãƒã‚§ãƒƒã‚¯
    await checkMultipleStores();
});

// ğŸ†• è¤‡æ•°åº—èˆ—ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
async function checkMultipleStores() {
    try {
        const token = localStorage.getItem('customer_token');
        const customerData = JSON.parse(localStorage.getItem('customer_data'));

        const response = await fetch('/api/customer/stores', {
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });

        if (!response.ok) return;

        const data = await response.json();
        const stores = data.data || [];

        if (stores.length > 1) {
            // è¤‡æ•°åº—èˆ—ã‚ã‚Š - åˆ‡ã‚Šæ›¿ãˆUIã‚’è¡¨ç¤º
            const storeSwitcher = document.getElementById('store-switcher');
            storeSwitcher.classList.remove('hidden');

            // ç¾åœ¨ã®åº—èˆ—åã‚’è¡¨ç¤º
            const currentStore = stores.find(s => s.customer_id === customerData.id);
            if (currentStore) {
                document.getElementById('current-store-name').textContent = currentStore.store_name;
            }

            // åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('switch-store-btn').addEventListener('click', () => {
                showStoreSwitcherModal(stores, customerData.id);
            });
        }

    } catch (error) {
        console.error('Error checking multiple stores:', error);
    }
}

// ğŸ†• åº—èˆ—åˆ‡ã‚Šæ›¿ãˆãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
function showStoreSwitcherModal(stores, currentCustomerId) {
    const storeList = document.getElementById('store-list');

    storeList.innerHTML = stores.map(store => `
        <div class="border ${store.customer_id === currentCustomerId ? 'border-2 border-blue-500 bg-blue-50' : 'border-gray-200'} rounded-lg p-4 cursor-pointer hover:border-blue-300 transition-colors"
             onclick="switchToStore(${store.customer_id})">
            <div class="flex items-center justify-between">
                <div class="flex-1">
                    <h4 class="font-semibold text-gray-900">
                        ğŸ“ ${store.store_name}
                    </h4>
                    <p class="text-sm text-gray-600 mt-1">
                        æœ€çµ‚æ¥åº—: ${store.last_visit_at ? new Date(store.last_visit_at).toLocaleDateString('ja-JP') : 'æœªæ¥åº—'}
                    </p>
                </div>
                ${store.customer_id === currentCustomerId ? `
                    <span class="bg-blue-600 text-white text-xs px-2 py-1 rounded font-medium">
                        âœ“ è¡¨ç¤ºä¸­
                    </span>
                ` : ''}
            </div>
        </div>
    `).join('');

    document.getElementById('storeSwitcherModal').classList.remove('hidden');
    document.body.style.overflow = 'hidden';
}

// ğŸ†• ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
function closeStoreSwitcherModal() {
    document.getElementById('storeSwitcherModal').classList.add('hidden');
    document.body.style.overflow = '';
}

// ğŸ†• åº—èˆ—ã‚’åˆ‡ã‚Šæ›¿ãˆ
async function switchToStore(targetCustomerId) {
    const currentCustomer = JSON.parse(localStorage.getItem('customer_data'));

    if (targetCustomerId === currentCustomer.id) {
        // åŒã˜åº—èˆ—ãªã®ã§ä½•ã‚‚ã—ãªã„
        closeStoreSwitcherModal();
        return;
    }

    try {
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
        const modal = document.getElementById('storeSwitcherModal');
        const originalContent = modal.innerHTML;
        modal.innerHTML = `
            <div class="bg-white rounded-lg p-8 text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                <p class="text-gray-700 font-medium">åº—èˆ—ã‚’åˆ‡ã‚Šæ›¿ãˆä¸­...</p>
                <p class="text-gray-500 text-sm mt-2">ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„</p>
            </div>
        `;

        const token = localStorage.getItem('customer_token');

        const response = await fetch('/api/auth/customer/switch-store', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                target_customer_id: targetCustomerId
            })
        });

        if (!response.ok) {
            throw new Error('åº—èˆ—åˆ‡ã‚Šæ›¿ãˆã«å¤±æ•—ã—ã¾ã—ãŸ');
        }

        const data = await response.json();

        // æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã¨é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
        localStorage.setItem('customer_token', data.data.token);
        localStorage.setItem('customer_data', JSON.stringify(data.data.customer));

        // ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰
        window.location.reload();

    } catch (error) {
        console.error('Store switch error:', error);
        alert('åº—èˆ—ã®åˆ‡ã‚Šæ›¿ãˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
        closeStoreSwitcherModal();
    }
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
document.addEventListener('click', function(event) {
    if (event.target === document.getElementById('storeSwitcherModal')) {
        closeStoreSwitcherModal();
    }
    // ... æ—¢å­˜ã®ãƒ¢ãƒ¼ãƒ€ãƒ«å‡¦ç† ...
});
```

---

## UI/UXä»•æ§˜

### ã‚«ãƒ©ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ 

| è¦ç´  | ã‚¯ãƒ©ã‚¹ | è‰² |
|------|--------|-----|
| ç¾åœ¨è¡¨ç¤ºä¸­ã®åº—èˆ—ï¼ˆèƒŒæ™¯ï¼‰ | `bg-blue-50` | è–„ã„é’ |
| ç¾åœ¨è¡¨ç¤ºä¸­ã®åº—èˆ—ï¼ˆãƒœãƒ¼ãƒ€ãƒ¼ï¼‰ | `border-2 border-blue-500` | æ¿ƒã„é’ãƒ»å¤ªã‚ |
| ç¾åœ¨è¡¨ç¤ºä¸­ã®ãƒãƒƒã‚¸ | `bg-blue-600 text-white` | é’åœ°ã«ç™½æ–‡å­— |
| ä»–ã®åº—èˆ—ï¼ˆèƒŒæ™¯ï¼‰ | `bg-white` | ç™½ |
| ä»–ã®åº—èˆ—ï¼ˆãƒœãƒ¼ãƒ€ãƒ¼ï¼‰ | `border-gray-200` | ã‚°ãƒ¬ãƒ¼ |
| ãƒ›ãƒãƒ¼æ™‚ | `hover:border-blue-300` | è–„ã„é’ |
| åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ | `text-blue-600 underline decoration-dotted` | é’ãƒ»ç‚¹ç·šä¸‹ç·š |

### ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ

```css
/* ãƒ¢ãƒã‚¤ãƒ«ï¼ˆã€œ768pxï¼‰ */
- ç¸¦ä¸¦ã³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- ãƒœã‚¿ãƒ³ã¯å¹…100%
- ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚º: text-sm

/* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒ»PCï¼ˆ768pxã€œï¼‰ */
- æ¨ªä¸¦ã³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- ãƒœã‚¿ãƒ³ã¯ autoå¹…
- ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚º: text-baseã€œtext-xl
```

### ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

```css
/* ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ */
.modal-enter {
    animation: fadeIn 0.2s ease-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

/* åº—èˆ—ã‚«ãƒ¼ãƒ‰ã®ãƒ›ãƒãƒ¼ */
.store-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: all 0.2s ease;
}
```

---

## ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

### ãƒ†ã‚¹ãƒˆ1: 1åº—èˆ—ã®ã¿ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼

**å‰ææ¡ä»¶**:
- ç”°ä¸­å¤ªéƒã•ã‚“ (phone: 09012345678) ãŒæ–°å®¿åº—ã®ã¿ã«ç™»éŒ²

**æ‰‹é †**:
1. ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã§é›»è©±ç•ªå·å…¥åŠ›
2. OTPå…¥åŠ›
3. ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ

**æœŸå¾…çµæœ**:
- âœ… åº—èˆ—é¸æŠç”»é¢ã¯**è¡¨ç¤ºã•ã‚Œãªã„**
- âœ… ãƒã‚¤ãƒšãƒ¼ã‚¸ã«ç›´æ¥é·ç§»
- âœ… ãƒ˜ãƒƒãƒ€ãƒ¼ã«åº—èˆ—åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã¯**è¡¨ç¤ºã•ã‚Œãªã„**

---

### ãƒ†ã‚¹ãƒˆ2: è¤‡æ•°åº—èˆ—ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆåˆå›ãƒ­ã‚°ã‚¤ãƒ³ï¼‰

**å‰ææ¡ä»¶**:
- ç”°ä¸­å¤ªéƒã•ã‚“ (phone: 09012345678) ãŒæ–°å®¿åº—ã¨ç§‹è‘‰åŸåº—ã®ä¸¡æ–¹ã«ç™»éŒ²

**æ‰‹é †**:
1. ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã§é›»è©±ç•ªå·å…¥åŠ›
2. OTPå…¥åŠ›
3. åº—èˆ—é¸æŠç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹
4. ç§‹è‘‰åŸåº—ã‚’é¸æŠ

**æœŸå¾…çµæœ**:
- âœ… åº—èˆ—é¸æŠç”»é¢ã«2åº—èˆ—è¡¨ç¤º
- âœ… æœ€çµ‚æ¥åº—æ—¥ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- âœ… ç§‹è‘‰åŸåº—ã‚’é¸æŠå¾Œã€ãƒã‚¤ãƒšãƒ¼ã‚¸ã«é·ç§»
- âœ… ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã€ŒğŸ“ ç›®ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°AKIBAæœ«åºƒç”ºåº— [åº—èˆ—ã‚’åˆ‡ã‚Šæ›¿ãˆ]ã€ãŒè¡¨ç¤º

---

### ãƒ†ã‚¹ãƒˆ3: åº—èˆ—åˆ‡ã‚Šæ›¿ãˆ

**å‰ææ¡ä»¶**:
- ãƒ†ã‚¹ãƒˆ2ã®ç¶šãï¼ˆç§‹è‘‰åŸåº—ã§ãƒ­ã‚°ã‚¤ãƒ³ä¸­ï¼‰

**æ‰‹é †**:
1. ãƒã‚¤ãƒšãƒ¼ã‚¸ã§ã€Œåº—èˆ—ã‚’åˆ‡ã‚Šæ›¿ãˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ãƒ¢ãƒ¼ãƒ€ãƒ«ã§æ–°å®¿åº—ã‚’é¸æŠ

**æœŸå¾…çµæœ**:
- âœ… ãƒ¢ãƒ¼ãƒ€ãƒ«ã«2åº—èˆ—è¡¨ç¤º
- âœ… ç§‹è‘‰åŸåº—ã«ã€Œâœ“ è¡¨ç¤ºä¸­ã€ãƒãƒƒã‚¸
- âœ… æ–°å®¿åº—ã‚’é¸æŠ
- âœ… ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
- âœ… ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰
- âœ… æ–°å®¿åº—ã®ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- âœ… ãƒ˜ãƒƒãƒ€ãƒ¼ãŒã€ŒğŸ“ ç›®ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ–°å®¿åº—ã€ã«å¤‰ã‚ã‚‹

---

### ãƒ†ã‚¹ãƒˆ4: ã‚«ãƒ«ãƒ†ãƒ»äºˆç´„ã®è¡¨ç¤º

**å‰ææ¡ä»¶**:
- ç”°ä¸­å¤ªéƒã•ã‚“ãŒæ–°å®¿åº—ï¼ˆcustomer_id=100ï¼‰ã¨ç§‹è‘‰åŸåº—ï¼ˆcustomer_id=200ï¼‰ã«ç™»éŒ²
- æ–°å®¿åº—ã§äºˆç´„5ä»¶ã€ã‚«ãƒ«ãƒ†3ä»¶
- ç§‹è‘‰åŸåº—ã§äºˆç´„2ä»¶ã€ã‚«ãƒ«ãƒ†1ä»¶

**æ‰‹é †**:
1. æ–°å®¿åº—ã§ãƒ­ã‚°ã‚¤ãƒ³
2. ã‚«ãƒ«ãƒ†ä¸€è¦§ã‚’è¡¨ç¤º
3. åº—èˆ—ã‚’ç§‹è‘‰åŸåº—ã«åˆ‡ã‚Šæ›¿ãˆ
4. ã‚«ãƒ«ãƒ†ä¸€è¦§ã‚’è¡¨ç¤º

**æœŸå¾…çµæœ**:
- âœ… æ–°å®¿åº—: ã‚«ãƒ«ãƒ†3ä»¶è¡¨ç¤º
- âœ… ç§‹è‘‰åŸåº—: ã‚«ãƒ«ãƒ†1ä»¶è¡¨ç¤º
- âœ… å„åº—èˆ—ã®ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãåˆ†é›¢ã•ã‚Œã¦ã„ã‚‹

---

### ãƒ†ã‚¹ãƒˆ5: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

**æ‰‹é †**:
1. ç”°ä¸­å¤ªéƒã•ã‚“ã§ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆcustomer_id=100ï¼‰
2. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œ:
```javascript
fetch('/api/auth/customer/switch-store', {
    method: 'POST',
    headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({
        target_customer_id: 999 // ä»–äººã®ID
    })
});
```

**æœŸå¾…çµæœ**:
- âœ… 403 Forbidden ã‚¨ãƒ©ãƒ¼
- âœ… ã€Œä¸æ­£ãªã‚¢ã‚¯ã‚»ã‚¹ã§ã™ã€ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

---

## ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †

### ç·Šæ€¥ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå¿…è¦ãªå ´åˆ

#### ã‚¹ãƒ†ãƒƒãƒ—1: ç¾åœ¨ã®ã‚³ãƒŸãƒƒãƒˆã‚’ç¢ºèª

```bash
git log --oneline -5
```

ç¾åœ¨ã®ã‚³ãƒŸãƒƒãƒˆ: `8c337ae`

#### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè¡Œ

```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
php artisan migrate:rollback --step=1

# ã‚³ãƒ¼ãƒ‰ã‚’ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
git reset --hard 8c337ae

# æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤
git push origin main --force  # âš ï¸ æ³¨æ„: force pushã¯æ…é‡ã«
```

#### ã‚¹ãƒ†ãƒƒãƒ—3: æœ¬ç•ªç’°å¢ƒã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

```bash
ssh ubuntu@54.64.54.226
cd /var/www/html
php artisan migrate:rollback --step=1
```

---

## ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

### ãƒªã‚¹ã‚¯1: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨ã®ç«¶åˆ

**å•é¡Œ**: æ—¢ã«åŒã˜é›»è©±ç•ªå·ã§ç•°ãªã‚‹åº—èˆ—ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¤±æ•—ã™ã‚‹å¯èƒ½æ€§

**å¯¾ç­–**:
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‰ã«ãƒ‡ãƒ¼ã‚¿ãƒã‚§ãƒƒã‚¯
- é‡è¤‡ãƒ‡ãƒ¼ã‚¿ã‚’äº‹å‰ã«ç¢ºèª

```sql
-- é‡è¤‡ãƒã‚§ãƒƒã‚¯SQL
SELECT phone, COUNT(*) as count, GROUP_CONCAT(id) as customer_ids, GROUP_CONCAT(store_id) as store_ids
FROM customers
WHERE phone IS NOT NULL AND phone != ''
GROUP BY phone
HAVING COUNT(*) > 1;
```

**çµæœ**: ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã¯é‡è¤‡0ä»¶ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

---

### ãƒªã‚¹ã‚¯2: ãƒˆãƒ¼ã‚¯ãƒ³ã®ç„¡åŠ¹åŒ–

**å•é¡Œ**: åº—èˆ—åˆ‡ã‚Šæ›¿ãˆæ™‚ã«å¤ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‰Šé™¤ã™ã‚‹ãŸã‚ã€ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹å ´åˆã«ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã•ã‚Œã‚‹

**å¯¾ç­–**:
- ä»•æ§˜ã¨ã—ã¦å—ã‘å…¥ã‚Œã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã§ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã•ã‚Œã¾ã™ã€ã¨é€šçŸ¥ï¼ˆå°†æ¥çš„ã«æ¤œè¨ï¼‰

---

### ãƒªã‚¹ã‚¯3: ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æœ‰åŠ¹æœŸé™

**å•é¡Œ**: åº—èˆ—é¸æŠç”»é¢ã§é•·æ™‚é–“æ“ä½œã—ãªã„ã¨ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒåˆ‡ã‚Œã‚‹

**å¯¾ç­–**:
- ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ‰åŠ¹æœŸé™ã‚’10åˆ†ã«è¨­å®šï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
- æœ‰åŠ¹æœŸé™åˆ‡ã‚Œæ™‚ã¯é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

---

### ãƒªã‚¹ã‚¯4: æœ¬ç•ªç’°å¢ƒã§ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—

**å•é¡Œ**: SQLiteã¨MySQL/PostgreSQLã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æŒ™å‹•ãŒç•°ãªã‚‹

**å¯¾ç­–**:
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’åˆ¤å®šï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
- ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§äº‹å‰ã«ãƒ†ã‚¹ãƒˆï¼ˆæ¨å¥¨ï¼‰

---

## å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ•ã‚§ãƒ¼ã‚º1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆDay 1ï¼‰

- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- [ ] é‡è¤‡ãƒ‡ãƒ¼ã‚¿ãƒã‚§ãƒƒã‚¯
- [ ] ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ

### ãƒ•ã‚§ãƒ¼ã‚º2: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆDay 1-2ï¼‰

- [ ] `CustomerAuthController::verifyOtp()` ä¿®æ­£
- [ ] `CustomerAuthController::selectStore()` è¿½åŠ 
- [ ] `CustomerAuthController::switchStore()` è¿½åŠ 
- [ ] `CustomerController::getStores()` è¿½åŠ 
- [ ] ãƒ«ãƒ¼ãƒˆè¿½åŠ 

### ãƒ•ã‚§ãƒ¼ã‚º3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆDay 2ï¼‰

- [ ] ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«åº—èˆ—é¸æŠUIè¿½åŠ 
- [ ] ãƒã‚¤ãƒšãƒ¼ã‚¸ã«åº—èˆ—åˆ‡ã‚Šæ›¿ãˆUIè¿½åŠ 
- [ ] ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¿½åŠ 
- [ ] JavaScriptå®Ÿè£…

### ãƒ•ã‚§ãƒ¼ã‚º4: ãƒ†ã‚¹ãƒˆï¼ˆDay 3ï¼‰

- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª1-5å®Ÿæ–½
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ†ã‚¹ãƒˆï¼ˆã‚¹ãƒãƒ›ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆï¼‰

### ãƒ•ã‚§ãƒ¼ã‚º5: ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆDay 3-4ï¼‰

- [ ] gitã‚³ãƒŸãƒƒãƒˆ
- [ ] æœ¬ç•ªç’°å¢ƒã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- [ ] æœ¬ç•ªç’°å¢ƒã§ãƒ†ã‚¹ãƒˆ
- [ ] ç›£è¦–ãƒ»ãƒ­ã‚°ç¢ºèª

---

## ä»˜éŒ²

### A. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒï¼ˆå¤‰æ›´å¾Œï¼‰

```sql
CREATE TABLE customers (
    id INTEGER PRIMARY KEY,
    store_id INTEGER,
    phone VARCHAR(20),
    email VARCHAR(255),
    -- ... ãã®ä»–ã®ã‚«ãƒ©ãƒ  ...

    -- ğŸ†• è¤‡åˆUNIQUEåˆ¶ç´„
    UNIQUE (store_id, phone),
    UNIQUE (store_id, email),
    UNIQUE (store_id, customer_number)
);
```

### B. APIä»•æ§˜

#### POST /api/auth/customer/verify-otp

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "phone": "09012345678",
  "otp_code": "123456",
  "remember_me": true
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆè¤‡æ•°åº—èˆ—ï¼‰**:
```json
{
  "success": true,
  "data": {
    "multiple_accounts": true,
    "phone": "09012345678",
    "temp_token": "abc123...",
    "stores": [
      {
        "customer_id": 100,
        "store_id": 1,
        "store_name": "ç›®ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ–°å®¿åº—",
        "last_visit_at": "2025-01-15T10:00:00Z"
      },
      {
        "customer_id": 200,
        "store_id": 4,
        "store_name": "ç›®ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°AKIBAæœ«åºƒç”ºåº—",
        "last_visit_at": "2025-02-10T14:30:00Z"
      }
    ]
  }
}
```

#### POST /api/auth/customer/select-store

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "temp_token": "abc123...",
  "customer_id": 200,
  "remember_me": true
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "success": true,
  "data": {
    "token": "xyz789...",
    "customer": {
      "id": 200,
      "name": "ç”°ä¸­ å¤ªéƒ",
      "store_id": 4,
      "store_name": "ç›®ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°AKIBAæœ«åºƒç”ºåº—"
    }
  }
}
```

#### POST /api/auth/customer/switch-store

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "target_customer_id": 100
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "success": true,
  "data": {
    "token": "new_token...",
    "customer": {
      "id": 100,
      "name": "ç”°ä¸­ å¤ªéƒ",
      "store_id": 1,
      "store_name": "ç›®ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ–°å®¿åº—"
    }
  }
}
```

#### GET /api/customer/stores

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "success": true,
  "data": [
    {
      "customer_id": 100,
      "store_id": 1,
      "store_name": "ç›®ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ–°å®¿åº—",
      "last_visit_at": "2025-01-15T10:00:00Z"
    },
    {
      "customer_id": 200,
      "store_id": 4,
      "store_name": "ç›®ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°AKIBAæœ«åºƒç”ºåº—",
      "last_visit_at": "2025-02-10T14:30:00Z"
    }
  ]
}
```

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ | ä½œæˆè€… |
|------|-----------|---------|--------|
| 2025-10-15 | 1.0 | åˆç‰ˆä½œæˆ | Claude |

---

**End of Document**
