# システム設定完全ガイド

## システム設定とは

店舗の基本情報、営業時間、通知設定など、システム全体の設定を管理する機能です。

---

## 店舗管理

### 店舗一覧の確認
1. サイドバー「設定」→「店舗管理」をクリック
2. 登録されている店舗の一覧が表示されます
3. 店舗名、住所、電話番号、営業状態が確認できます

### 新しい店舗の追加
1. 店舗管理画面で右上の「新規作成」ボタン
2. 基本情報を入力：
   - **店舗名**: 必須
   - **郵便番号**: ハイフンなしで入力
   - **住所**: 都道府県から番地まで
   - **電話番号**: ハイフンなしでも可
   - **メールアドレス**: お問い合わせ用
   - **営業状態**: 有効/無効
3. 「作成」ボタンをクリック

### 営業時間の設定
1. 店舗詳細画面を開く
2. 「営業時間」タブをクリック
3. 曜日ごとに営業時間を設定：
   - **営業開始時刻**: 例：10:00
   - **営業終了時刻**: 例：20:00
   - **休憩時間**: 複数設定可能
   - **定休日**: チェックボックスで選択
4. 「保存」ボタンをクリック

**💡 ポイント**:
- 曜日ごとに異なる営業時間を設定可能
- 祝日の営業時間も個別設定できます

### 最終受付時間の設定
1. 店舗詳細画面の「営業時間」タブ
2. 「最終受付時刻」を設定
3. 営業終了時刻の30分〜1時間前を推奨

**例**: 営業終了20:00、最終受付19:00

---

## ユーザー管理

### ユーザー一覧の確認
1. サイドバー「設定」→「ユーザー管理」をクリック
2. 登録されているユーザーの一覧が表示されます
3. 名前、メール、権限、所属店舗が確認できます

### 新しいユーザーの追加（スタッフ登録）
1. ユーザー管理画面で右上の「新規作成」ボタン
2. 以下の項目を入力：
   - **名前**: 必須
   - **メールアドレス**: ログインID
   - **パスワード**: 初期パスワード
   - **権限**: 以下から選択
     - super_admin: スーパー管理者
     - owner: オーナー
     - store_manager: 店長
     - staff: スタッフ
   - **所属店舗**: 勤務店舗を選択
3. 「作成」ボタンをクリック

**💡 ポイント**:
- 初回ログイン時にパスワード変更を促してください
- メールアドレスは重複不可

### 権限の違い

| 権限 | できること |
|------|------------|
| **super_admin** | 全店舗・全機能にアクセス可能、システム設定変更可能 |
| **owner** | 複数店舗の管理、売上レポート確認 |
| **store_manager** | 所属店舗の全機能、スタッフ管理 |
| **staff** | 所属店舗の予約・カルテ作成のみ |

### パスワードリセット
1. ユーザー一覧で対象ユーザーをクリック
2. 「パスワードリセット」ボタンをクリック
3. 新しいパスワードを入力
4. 「保存」ボタンをクリック

### ユーザーの無効化
1. ユーザー詳細画面を開く
2. 「有効」をOFFにする
3. 「保存」ボタンをクリック

**💡 ポイント**: 無効化すると、そのユーザーはログインできなくなります

---

## 通知設定

### 通知の種類
- **予約確認通知**: 予約作成時に顧客へ送信
- **予約リマインダー**: 予約日の前日に送信
- **キャンセル通知**: 予約キャンセル時に送信
- **サブスク決済通知**: 決済完了/失敗時に送信
- **管理者通知**: 新規予約時に管理者へ送信

### LINE通知の設定
1. サイドバー「設定」→「通知設定」
2. 「LINE設定」タブをクリック
3. 以下を設定：
   - **LINE Channel ID**: LINEアカウント設定から取得
   - **LINE Channel Secret**: 同上
   - **LINE Access Token**: 同上
4. 「接続テスト」ボタンで確認
5. 「保存」ボタンをクリック

### メール通知の設定
1. 「メール設定」タブをクリック
2. 以下を設定：
   - **送信元メールアドレス**: 店舗のメールアドレス
   - **送信元名**: 店舗名
   - **SMTPサーバー**: メールサーバー情報
   - **SMTPポート**: 通常587または465
   - **SMTP認証情報**: ユーザー名/パスワード
3. 「テスト送信」ボタンで確認
4. 「保存」ボタンをクリック

### SMS通知の設定
1. 「SMS設定」タブをクリック
2. SMS送信サービスのAPI情報を入力
3. 「テスト送信」ボタンで確認
4. 「保存」ボタンをクリック

### 通知の有効/無効切り替え
1. 通知設定画面で各通知項目を確認
2. 不要な通知はOFFにできます
3. 「保存」ボタンをクリック

---

## 決済設定

### J-Payment設定
1. サイドバー「設定」→「決済設定」
2. 「J-Payment」タブをクリック
3. 以下を設定：
   - **マーチャントID**: J-Paymentから発行
   - **APIキー**: 同上
   - **決済用Webhook URL**: `/api/webhook/jpayment/payment`
   - **サブスク用Webhook URL**: `/api/webhook/jpayment/subscription`
4. 「接続テスト」ボタンで確認
5. 「保存」ボタンをクリック

### クレジットカード決済の有効化
1. 決済設定画面で「クレジットカード決済」をON
2. テスト決済で動作確認
3. 本番モードに切り替え

---

## メニューカテゴリの並び順設定

### 表示順の変更
1. サイドバー「メニュー管理」→「メニューカテゴリ」
2. 各カテゴリの「表示順」を編集
3. 数字が小さいほど上位に表示されます

### ドラッグ&ドロップで並び替え
1. カテゴリ一覧でカテゴリをドラッグ
2. 新しい位置にドロップ
3. 自動的に表示順が更新されます

---

## 予約ブロック時間帯の設定

### 定期的なブロック時間の設定
1. サイドバー「設定」→「ブロック時間帯」
2. 「新規作成」ボタンをクリック
3. 以下を設定：
   - **曜日**: 毎週何曜日か
   - **開始時刻**: ブロック開始時間
   - **終了時刻**: ブロック終了時間
   - **理由**: 清掃、ミーティングなど
   - **対象ライン**: 全ライン/特定ラインを選択
4. 「作成」ボタンをクリック

**💡 ポイント**: 毎週の定例ミーティングなどに便利

---

## システムメンテナンス

### キャッシュのクリア
1. サイドバー「設定」→「システム」
2. 「キャッシュクリア」ボタンをクリック
3. 確認ダイアログで「実行」

**タイミング**: 設定変更後、動作がおかしい時

### ログの確認
1. サイドバー「設定」→「システムログ」
2. エラーログが一覧表示されます
3. 日付でフィルタリング可能

### データベースバックアップ
1. サイドバー「設定」→「バックアップ」
2. 「今すぐバックアップ」ボタンをクリック
3. ファイルがダウンロードされます

**推奨頻度**: 毎日自動バックアップ + 週1回手動確認

---

## Claude AI設定

### Claude APIの設定
1. サイドバー「設定」→「Claude設定」
2. 以下を設定：
   - **APIキー**: Anthropic Consoleで取得
   - **モデル**: claude-sonnet-4-5-20250929
   - **最大トークン数**: 1024
   - **1日あたり利用制限（ユーザーごと）**: 20回
   - **月間利用制限（全体）**: 1000回
3. 「接続テスト」ボタンで確認
4. 「Claude機能を有効化」をON
5. 「保存」ボタンをクリック

### ヘルプチャット質問履歴の確認
1. サイドバー「設定」→「ヘルプ質問履歴」
2. スタッフからの全質問が一覧表示されます
3. フィルター:
   - 解決済み/未解決
   - 日付範囲
   - ユーザー

**💡 ポイント**: よくある質問を見つけてマニュアルを改善

---

## よくある質問

**Q: スタッフが自分で設定を変更できないようにしたい**
A: スタッフ権限では設定画面にアクセスできません。店長以上の権限が必要です。

**Q: 営業時間を一時的に変更したい**
A: 店舗設定で営業時間を変更してください。元に戻すのを忘れないように注意。

**Q: 通知が届かない**
A: 通知設定を確認し、テスト送信で動作確認してください。LINE/メール/SMSそれぞれ設定が必要です。

**Q: パスワードを忘れたスタッフがいます**
A: ユーザー管理からパスワードリセットを実行してください。

**Q: 複数店舗で同じスタッフを使いたい**
A: ユーザー設定で所属店舗を変更できます。ただし、主な所属店舗は1つです。

**Q: システムが重くなってきた**
A: キャッシュクリアを実行してください。改善しない場合はデータベースバックアップ後、管理者に連絡。

**Q: Claude APIの料金はいくらですか？**
A: Prompt Cachingにより1回あたり約$0.001。月1000回で約$10〜20程度です。

**Q: ヘルプチャットを無効にできますか？**
A: Claude設定で「Claude機能を有効化」をOFFにしてください。
