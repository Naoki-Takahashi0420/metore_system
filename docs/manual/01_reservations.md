# 予約管理

## 予約の確認方法

### ダッシュボードで確認
1. 管理画面トップ（ダッシュボード）に本日の予約一覧が表示されます
2. 「予約カレンダー」ウィジェットで月間予約を確認できます
3. **「予約タイムライン」ウィジェットで当日のスタッフ別予約を確認できます**
   - 横軸が時間、縦軸がスタッフ/ライン
   - 予約をクリックすると詳細が表示されます
   - ドラッグ&ドロップで予約時間を変更可能

### 予約管理画面で確認
1. サイドバーの「予約管理」をクリック
2. 一覧で全予約を確認できます
3. フィルター機能で絞り込み可能：
   - 日付範囲
   - 店舗
   - スタッフ
   - 顧客名
   - 予約ステータス（確認済み/キャンセル等）

## 新規予約の登録方法

### 📌 方法1: タイムラインから予約作成（おすすめ！）
**ダッシュボードの「予約タイムライン」から直接予約を作れます**

1. ダッシュボードの「予約タイムライン」を表示
2. 店舗と日付を選択
3. タイムライン上の空き時間をクリック
4. 顧客を検索・選択（または新規登録）
   - 電話番号で検索するとすぐ見つかります
   - 新規顧客の場合は「新規顧客登録」タブから登録
5. メニューを選択
   - メニュー名で検索可能
   - オプションメニューも追加できます
6. 開始時間と所要時間を調整
7. スタッフを選択（任意）
8. 「予約を作成」ボタンをクリック

**メリット**:
- 空き時間が視覚的にわかる
- 他の予約との重複を防げる
- 素早く予約を作成できる
- リアルタイムで予約状況を確認しながら作成できる

### 方法2: 予約管理画面から作成
1. サイドバー「予約管理」→ 右上の「新規作成」ボタン
2. 以下の項目を入力：
   - **顧客**: 検索して選択（新規顧客の場合は先に顧客登録が必要）
   - **店舗**: 店舗を選択
   - **予約日**: カレンダーから選択
   - **開始時刻**: 時刻を選択
   - **メニュー**: 施術メニューを選択
   - **スタッフ**: 担当スタッフを選択（任意）
   - **予約元**: 「電話」「来店」「管理画面」から選択
3. 「作成」ボタンをクリック

### 方法3: カレンダーからドラッグ&ドロップ
1. ダッシュボードの予約カレンダーで日付をクリック
2. 予約作成フォームが開きます
3. 必要項目を入力して作成

### 注意点
- 既に予約がある時間帯は選択できません
- 営業時間外は予約できません
- サブスク・チケット利用の場合は、対象メニューのみ選択可能
- タイムラインでは空き状況がリアルタイムで反映されます

## 予約の変更

### 日程変更の手順
1. 予約管理画面で変更したい予約の行を見つける
2. 操作列の「日程変更」ボタンをクリック
3. 新しい日時を選択
4. 「保存」ボタンをクリック

**注意**: 予約詳細画面には編集ボタンはありません。日程変更は必ず一覧画面の「日程変更」ボタンから行ってください。

### カレンダーからのドラッグ&ドロップ変更
1. ダッシュボードの予約カレンダーで予約をドラッグ
2. 新しい日時にドロップ
3. 確認ダイアログで「OK」

## 予約ステータスの変更

### 予約済み → 完了にする
1. 予約管理画面で該当の予約の行を見つける
2. 操作列の「完了」ボタンをクリック
3. 確認ダイアログで「確認」をクリック
4. サブスク利用の場合、利用回数が自動更新されます
5. カルテ作成画面へのリンクが表示されます

### 予約済み → 来店なしにする
1. 予約管理画面で該当の予約の行を見つける
2. 操作列の「来店なし」ボタンをクリック
3. 確認ダイアログで「確認」をクリック

### 予約済み → キャンセルにする
1. 予約管理画面で該当の予約の行を見つける
2. 操作列の「キャンセル」ボタンをクリック
3. キャンセル理由を入力（必須）
4. 「確認」ボタンをクリック

## 予約ステータスを誤って変更した場合

### 完了/キャンセル/来店なし → 予約済みに戻す
1. 予約管理画面で該当の予約の行を見つける
2. 操作列の「予約を復元」ボタンをクリック
3. 確認ダイアログで「確認」をクリック
4. ステータスが「予約済み」に戻ります

**重要**: 予約詳細画面には編集ボタンやステータス変更ボタンはありません。すべての操作は予約管理画面の一覧から行います。

## 予約のキャンセル

### 手順
上記「予約済み → キャンセルにする」を参照してください。

### キャンセル時の注意
- サブスク予約の場合、利用回数は復元されます
- チケット予約の場合、チケット枚数は復元されます
- キャンセル通知が顧客に自動送信されます（LINE/SMS）

## よくある質問

**Q: 顧客が見つかりません**
A: 予約作成画面の顧客検索では、姓または名で部分一致検索できます。電話番号でも検索可能です。見つからない場合は、先に「顧客管理」から顧客登録を行ってください。

**Q: サブスク顧客の予約方法は？**
A: 通常の予約と同じです。メニュー選択時にサブスクプランに含まれるメニューを選択すると、自動的にサブスク利用回数が消費されます。

**Q: 予約時間を過ぎた予約の扱いは？**
A: 自動的にステータスは変わりません。スタッフが手動で「完了」または「キャンセル」に変更してください。
